\label{ride-sharing}
\subsubsection{Purpose}

Every subscribed passenger shall be able to activate the ride sharing function in the mobile app or in the web interface. When this mode is enabled, the passenger has to provide the system also with a destination for the ride.

The system, before allocating a taxi, inserts the pending ride in the set of shared rides and tries to identify possible sharing solutions.
With an adequate algorithm it can propose every feasible sharing solution to the user.

The first user who reserves a taxi is called the ``owner'' of the ride.
The passenger can choose to join one of the pending rides or to refuse the proposal, becoming the owner of a new ride.

In the first case the system informs the owner of the ride. The new passenger has to go to the meeting point with the owner of the ride in time. If he/she is not able to do that the taxi does not wait for him/her.

In the second case the system allocates the taxi (\ref{taxi-availability}) and applies the standard procedure (\ref{standard-call}).  The user becomes the owner of the ride.
If there is another passenger willing to share the same ride, the system allows it and redirects this last user to the meeting point with the owner, who is informed as well as the taxi driver.

\subsubsection{Scenario 1}
Batman needs a taxi and decides to enable the sharing mode on his cell phone. The app also asks Batman for the destination of his travel and the number of seats (one).

When Batman submits the form, the system matches the path of Batman's ride with every pending ride started from Batman's area. It finds only one compatible ride and sends it to Batman.

Batman finds that it is Joker's pending ride and refuses to share the ride.
So, the system allocates a new taxi.

A new user, Robin, is in Batman's area and needs a taxi. He decides to enable the sharing function and the system proposes him Batman's and Joker's rides.
He chooses Batman's: the system, which has already communicated location and time to Robin, notifies Batman and the taxi driver that there is an additional passenger.

When the taxi arrives, the taxi driver confirms from his mobile app how many passengers he has picked up.

\subsubsection{Use case}
The use case for a ride sharing is shown in~\autoref{usecase-ridesharing}.

\begin{table}
\begin{center}
\begin{tabular}{| l | p{0.6\textwidth} |}
\hline
Actor & Taxi driver and Multiple Passengers \\
\hline
Goal & Goal~\ref{g-share}
\\
\hline
Input condition & The user enables the sharing option from his mobile phone or from the web interface.  \\
\hline
Event Flow &
\begin{enumerate}
	\item The passenger enables the sharing option.
	\item The passenger enters a destination, and the number of required seats.
	\item The system computes the feasible shared rides and proposes them to the passenger.
	\item The passenger can accept one of the sharing options or refuse all of them.
	\item If the passenger refuses, the system executes the standard taxi call \ref{standard-call}, otherwise it notifies the owner of the ride and the taxi driver.
\end{enumerate}
\\
\hline
Output condition & The system informs the owner of the ride and the taxi driver that the ride will be shared. \\
\hline
Exception & No taxi available in the area. \\
\hline
\end{tabular}
\end{center}
\caption{Use case for ride sharing.}
\label{usecase-ridesharing}
\end{table}

\subsubsection{Response sequence}
The response sequence is illustrated in figure \ref{fig:sequence-sharing}

\begin{figure}
	\includegraphics[width=\textwidth]{diagrams/sequence_ride_sharing.pdf}
	\caption{Sequence diagram of a ride sharing.}
	\label{fig:sequence-sharing}
\end{figure}

\subsubsection{Associated functional requirements}
\begin{enumerate}
\item The system has to know the starting point of the new passenger in order to provide feasible sharing solutions.
It has to compute the estimated walking time to reach the meeting location and compare it with the estimated taxi arrival time.
\item The passenger can enable the sharing function both in the mobile app and in the web interface.
\item The passenger can choose between possible sharing solutions or a new taxi.
\item The system has to communicate to the taxi driver the presence of a new passenger.
\item The system must be able to analyse the current sharing situation. % TODO too generic
\item The total number of passengers must not exceed the number of seats available in each taxi.
\item The taxi driver can insert the number of passengers who have been picked up.
\item After the user chooses to enable the sharing mode, the system has to specify, for every sharing ride, the location and the time.
\end{enumerate}
